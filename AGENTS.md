# Project Agents.md ガイド

このリポジトリは [MoonBit](https://docs.moonbitlang.com) プロジェクトです。

## プロジェクト構成

- MoonBit のパッケージはディレクトリ単位で整理されています。各ディレクトリには依存関係を列挙した `moon.pkg.json` があり、各パッケージはソースファイルとブラックボックステスト（末尾が `_test.mbt`）およびホワイトボックステスト（末尾が `_wbtest.mbt`）を持ちます。

- トップレベルのディレクトリには、モジュールやメタ情報を記載した `moon.mod.json` があります。

## コーディング規約

- MoonBit のコードはブロック形式で整理され、各ブロックは `///|` で区切られます。ブロックの順序は重要ではありません。リファクタリングの際はブロック単位で独立して処理できます。

- 廃止予定のブロックは各ディレクトリの `deprecated.mbt` に残すことを推奨します。

## ツール

- `moon fmt` はコードのフォーマットに使用します。

- `moon info` はパッケージの生成されたインターフェースを更新するために使用します。各パッケージには `.mbti` という生成されたインターフェースファイルがあり、パッケージ利用者向けの簡潔な形式的説明が入ります。`.mbti` に差分が無ければ、外部向けの可視的な変更がないことを意味し、通常は安全なリファクタリングです。

- 最後に `moon info && moon fmt` を実行してインターフェースを更新し、コードを整形してください。`.mbti` ファイルの差分を確認して変更が期待通りか確認します。

- `moon test` を実行してテストが通ることを確認してください。MoonBit はスナップショットテストをサポートしているため、挙動が変わる変更を加えた場合は `moon test --update` を実行してスナップショットを更新してください。

- `moon check` を実行してコードの lint を確認できます。

- テストを書く際は `inspect` を使い、`moon test --update` でスナップショットを更新することを推奨します。ループなどでスナップショットが変動する場合のみ `assert_eq` のようなアサーションを使ってください。カバレッジを確認するには `moon coverage analyze > uncovered.log` を使ってください。

- `agent-todo.md` にはエージェント（AI）が取り組みやすい小さなタスクが含まれています。エージェントはそれらを完了してチェックボックスをオンにして問題ありません。

## PRレビュー

PRをレビューする際には`pr_review`スキルを使ってください
